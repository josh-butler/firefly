const { v4: uuid } = require('uuid');

const report = "<taskReport encoding=\"utf-8\" lastUpdate=\"1622638112.42\" updatedBy=\"\">\n\n  <toplevelinfo Error=\"0\" Filepath=\"C:\\batonSites\\CheckerServer\\projects\\medium_3b88a90ba890e5109ac8f95fccab030f_mp4_00000179ccc274122d2063fe000a6bcdb20e8ddf\\medium_3b88a90ba890e5109ac8f95fccab030f.mp4\" Format=\"MP4\" Neighbours=\"0\" Summary=\"File has 0 errors, 3 warnings\" Warning=\"3\" />\n\n  <hierarchy value=\"(SYS)(SYS Level=-1- Name=-Video- ID=-NA- IDName=-StreamID-/)(SYS Level=-2- Name=-H264 Video- ID=-1- parent=-0-/)(SYS Level=-1- Name=-Audio- ID=-NA- IDName=-StreamID-/)(SYS Level=-2- Name=-AAC Audio- ID=-2- parent=-0-/)(/SYS)\" />\n\n  <streamnode EncodedDuration=\"-1\" Error=\"0\" StartTimecode=\"0\" Warning=\"0\" id=\"0\" name=\"MP4 File\" parent=\"0\">\n    <errors>\n      <customchecks>\n        <systemencodingchecks name=\"System Level\" sectionName=\"Common\" />\n        <MP4checks name=\"MP4 File\" sectionName=\"Common\" />\n      </customchecks>\n      <conformancechecks />\n    </errors>\n    <info>\n      <field name=\"Creation Time\" value=\"2020-03-18T20:41:06Z\" />\n      <field name=\"AudioLangTrackIDMap\">\n        <mapping key=\"1\" value=\"English\" />\n        <mapping key=\"2\" value=\"Undetermined\" />\n      </field>\n      <field name=\"MP4::Duration\" value=\"00:00:30:208\" />\n      <field name=\"Timed Text Track\" value=\"Not Present\" />\n      <field desc=\"Info not found\" name=\"Audio Channel Layout\" />\n      <field name=\"Data Format\" value=\"avc1, mp4a\" />\n      <field name=\"DisabledTrack\" value=\"Not Present\" />\n      <field name=\"MP4::ChannelCount\">\n        <mapping key=\"2\" value=\"2\" />\n      </field>\n      <field name=\"FileSize\" value=\"5095834\" />\n      <field desc=\"Not Present\" name=\"TimeCode Track\" />\n      <field name=\"Container::Bitrate\" unit=\"Mbps\" value=\"1.35\" />\n      <field desc=\"Info not found\" name=\"3GPP Profile\" />\n      <field name=\"Atom Presence\" value=\"Not Present\" />\n    </info>\n    <summary />\n  </streamnode>\n\n  <streamnode EncodedDuration=\"30208\" Error=\"0\" StartTimecode=\"0\" TimecodeType=\"NonDropFrame\" Warning=\"3\" id=\"1\" name=\"H264 Video\" parent=\"0\">\n    <errors>\n      <customchecks>\n        <genericvideochecks name=\"Video Description\" sectionName=\"Common\" />\n        <decodedvideochecks name=\"Video Quality\" sectionName=\"Common\">\n          <error EBUCode=\"0050B\" FrameDuration=\"274\" SMPTETimecodeDuration=\"00:00:11:10\" TimeCodeDuration=\"11416\" description=\"Blurriness is persistent for 00:00:11:416, starting at 00:00:03:167 and with average level as 41.54. Specified criteria: Report as Warning if 'Blurriness Level'  more than 25, 'persists'  more than 00:00:02:000\" endframeindex=\"349\" endsmptetimecode=\"00:00:14:13\" endtimecode=\"00:00:14:542\" id=\"VQ.0007.01\" item=\"Blurriness\" itemIndex=\"0\" location=\"Frame[76]\" rap_sequence_num=\"0\" severity=\"Warning\" smptetimecode=\"00:00:03:04\" startframeindex=\"76\" startsmptetimecode=\"00:00:03:04\" starttimecode=\"00:00:03:167\" subitem=\"Blurriness Level(0 - 100),Maximum Burst\" synopsis=\"Blurriness exceeds the acceptable duration.\" timecode=\"00:00:03:167\">\n            <Params>\n              <Param Name=\"AverageLevel\" Value=\"41.54\" />\n            </Params>\n          </error>\n          <error EBUCode=\"0050B\" FrameDuration=\"80\" SMPTETimecodeDuration=\"00:00:03:08\" TimeCodeDuration=\"3333\" description=\"Blurriness is persistent for 00:00:03:333, starting at 00:00:22:750 and with average level as 37.85. Specified criteria: Report as Warning if 'Blurriness Level'  more than 25, 'persists'  more than 00:00:02:000\" endframeindex=\"625\" endsmptetimecode=\"00:00:26:01\" endtimecode=\"00:00:26:042\" id=\"VQ.0007.01\" item=\"Blurriness\" itemIndex=\"0\" location=\"Frame[546]\" rap_sequence_num=\"3\" severity=\"Warning\" smptetimecode=\"00:00:22:18\" startframeindex=\"546\" startsmptetimecode=\"00:00:22:18\" starttimecode=\"00:00:22:750\" subitem=\"Blurriness Level(0 - 100),Maximum Burst\" synopsis=\"Blurriness exceeds the acceptable duration.\" timecode=\"00:00:22:750\">\n            <Params>\n              <Param Name=\"AverageLevel\" Value=\"37.85\" />\n            </Params>\n          </error>\n          <error EBUCode=\"0050B\" description=\"Blurriness is detected in 54 Percent of the stream. Specified criteria: Report as Warning if 'Blurriness Level'  more than 25, 'persists'  more than 30 Percent\" id=\"VQ.0007.02\" item=\"Blurriness\" itemIndex=\"0\" severity=\"Warning\" subitem=\"Blurriness Level(0 - 100),Maximum Percentage\" synopsis=\"Percentage of the stream content with Blurriness exceeds the acceptable limit.\">\n            <Params>\n              <Param Name=\"Percentage_Duration\" Value=\"54\" />\n            </Params>\n          </error>\n        </decodedvideochecks>\n        <decoded3dvideochecks name=\"3D Video Quality\" sectionName=\"Common\" />\n        <H264videochecks name=\"H264 Video\" sectionName=\"Common\" />\n        <burntinsubtitlechecks name=\"Burnt-in Subtitles\" sectionName=\"Common\" />\n      </customchecks>\n      <conformancechecks />\n    </errors>\n    <info>\n      <field name=\"Resolution\" timecode=\"00:00:09:250\" value=\"960x540\" />\n      <field name=\"Chroma Format\" timecode=\"00:00:09:250\" value=\"4:2:0\" />\n      <field name=\"Frame Rate\" timecode=\"00:00:09:250\" value=\"23.976\" />\n      <field name=\"Sample Aspect Ratio\" timecode=\"00:00:09:250\" value=\"1:1\" />\n      <field name=\"Picture Scanning Type\" timecode=\"00:00:09:250\" value=\"Progressive\" />\n      <field name=\"Profile\" timecode=\"00:00:09:250\" value=\"Main\" />\n      <field name=\"Level\" timecode=\"00:00:09:250\" value=\"3.0\" />\n      <field name=\"DPB Size\" timecode=\"00:00:09:250\" value=\"3\" />\n      <field name=\"Duration\">\n        <Duration value=\"00:00:30:030\" />\n        <DurationFrames value=\"720\" />\n        <DurationSMPTE value=\"00:00:30:00\" />\n      </field>\n      <field name=\"Average Bitrate\" timecode=\"00:00:29:958\" value=\"1.25\" />\n      <field desc=\"Not Present\" name=\"ColorBar\" />\n      <field name=\"BrightnessRange\">\n        <min value=\"-58\" />\n        <max value=\"9\" />\n      </field>\n      <field name=\"ContrastRange\">\n        <min value=\"10\" />\n        <max value=\"66\" />\n      </field>\n      <field name=\"Display Aspect Ratio\" value=\"16:9\" />\n      <field name=\"Active Pixels\">\n        <area value=\"960x540\" />\n        <coverage value=\"100.00\" />\n      </field>\n      <field name=\"BitrateMode\" value=\"VBR\" />\n      <field name=\"Instantaneous Bitrate\">\n        <max value=\"1.37\" />\n        <min value=\"1.16\" />\n      </field>\n      <field name=\"Resolution Change\" value=\"false\" />\n      <field name=\"Cadence Change (Encoded)\" value=\"false\" />\n      <field name=\"Cadence Pattern (Encoded)\" value=\"2-2\" />\n      <field name=\"Picture Scanning Type Change\" value=\"false\" />\n      <field name=\"H264::BitrateMode\" value=\"CBR\" />\n      <field desc=\"Info not found\" name=\"Scan Order\" />\n      <field desc=\"Info not found\" name=\"Video Format\" />\n    </info>\n    <summary />\n  </streamnode>\n\n  <streamnode EncodedDuration=\"30208\" Error=\"0\" StartTimecode=\"0\" TimecodeType=\"NonDropFrame\" Warning=\"0\" id=\"2\" name=\"AAC Audio\" parent=\"0\">\n    <errors>\n      <customchecks>\n        <genericaudiochecks name=\"Audio Description\" sectionName=\"Common\" />\n        <decodedaudiochecks name=\"Audio Quality\" sectionName=\"Common\" />\n        <AACaudiochecks name=\"AAC Audio\" sectionName=\"Common\" />\n      </customchecks>\n      <conformancechecks />\n    </errors>\n    <info>\n      <field name=\"Sampling Frequency\" timecode=\"00:00:00:000\" value=\"48000\" />\n      <field name=\"LFE Channels\" timecode=\"00:00:00:000\" value=\"0\" />\n      <field name=\"Bits per sample\" timecode=\"00:00:00:000\" value=\"16\" />\n      <field name=\"Audio Channels\" timecode=\"00:00:00:000\" value=\"2\" />\n      <field name=\"Channel Configuration\" timecode=\"00:00:00:000\" value=\"L, R\" />\n      <field name=\"Encoded Bitrate Mode\" timecode=\"00:00:00:000\" value=\"CBR\" />\n      <field name=\"Applied Channel Configuration\" value=\"L, R\" />\n      <field name=\"Bit Rate\" timecode=\"00:00:30:186\" unit=\"Kbps\" value=\"102\" />\n      <field internal=\"yes\" name=\"Duration_msec\" value=\"00:00:30:208\" />\n      <field name=\"Audio::Duration\" value=\"00:00:30:208\" />\n      <field name=\"Phase Mismatch\" value=\"Not Present\" />\n      <field name=\"EAS Message\" value=\"Not Present\" />\n      <field name=\"Average Level\">\n        <mapping key=\"L\" value=\"-29.933\" />\n      </field>\n      <field name=\"ProgramLoudnessCALMAct\">\n        <ProgramLoudness>\n          <end value=\"00:00:30:208\" />\n          <level value=\"-24.3\" />\n          <start value=\"00:00:00:000\" />\n        </ProgramLoudness>\n      </field>\n      <field name=\"LoudnessProfile\">\n        <ProgramLoudnessLevel value=\"-24.3\" />\n      </field>\n      <field name=\"TruePeakLevelCALMAct2\">\n        <TruePeakStruct>\n          <channel value=\"L\" />\n          <level value=\"-9.7\" />\n          <timecode value=\"00:00:20:330\" />\n        </TruePeakStruct>\n        <TruePeakStruct>\n          <channel value=\"R\" />\n          <level value=\"-9.8\" />\n          <timecode value=\"00:00:23:552\" />\n        </TruePeakStruct>\n      </field>\n      <field name=\"Maximum Level\">\n        <mapping key=\"L\" value=\"-9.725\" />\n      </field>\n      <field name=\"Transient Noise\" value=\"Not Present\" />\n      <field name=\"Wow and Flutter\" value=\"Not Present\" />\n      <field name=\"Background Noise\" value=\"Not Present\" />\n      <field name=\"Jitter Noise\" value=\"Not Present\" />\n      <field name=\"Audio Clipping\" value=\"Not Present\" />\n      <field desc=\"Can't be determined\" name=\"Misplaced Channels\" />\n      <field name=\"High Frequency Noise\" value=\"Not Present\" />\n      <field name=\"Overmodulation\" value=\"Not Present\" />\n    </info>\n    <summary />\n  </streamnode>\n\n</taskReport>"

exports.handler = async event => {
  console.log('event: ', event);
  let resp;

  const { type, params } = event;

  switch (type) {
    case 'taskReport':
      resp = { status: 200, data: report };
      break;
    case 'submitFile':
      resp = { data: { taskId: uuid() } };
      break;
    default:
      resp = { data: { taskId: uuid() } };
  }
  // const statusCode = 200;
  // const headers = { 'Access-Control-Allow-Origin': '*', 'Content-Type': 'application/json' };
  // const body = JSON.stringify({ status: 'ok' });

  return resp;
};
