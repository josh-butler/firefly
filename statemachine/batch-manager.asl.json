{
  "Comment": "Submits & manages a batch job's lifecycle",
  "StartAt": "GetBatch",
  "States": {
    "GetBatch": {
        "Type": "Pass",
        "Next": "SubmittedEvent"
    },
    "SubmittedEvent": {
        "Type": "Task",
        "Resource": "arn:aws:states:::events:putEvents",
        "Comment": "send batch submitted event",
        "Parameters": {
          "Entries": [
            {
              "EventBusName": "${EventBusName}",
              "Source": "tact.sfn.batch-manager",
              "DetailType": "SFN_BATCH_SUBMITTED",
              "Detail": { "Message": "Test SFN event" }
            }
          ]
        },
        "Next": "MonitorBatch"
    },
    "MonitorBatch": {
      "Type": "Task",
      "Resource": "arn:aws:states:::states:startExecution.sync",
      "Comment": "start batch monitor state machine",
      "Parameters": {
        "StateMachineArn": "${BatchMonitorSM}",
        "Input": {
          "batch": {
            "pk": "BATCH#1uDOytYz85ANZ1bGItAssUalrgG",
            "jobs": [
              {
                "pk": "BATCH#1uDOytYz85ANZ1bGItAssUalrgG",
                "sk": "JOB#1uDOys2wFfuGtVVjQmFj2hvOCOZ"
              },
              {
                "pk": "BATCH#1uDOytYz85ANZ1bGItAssUalrgG",
                "sk": "JOB#1uDOysaadxliuZyg6Bqufu8yrmt"
              }
            ],
            "intervalSeconds": "60",
            "maxAttempts": "3"
          }
        }
      },
      "Next": "PublishResults"
    },
    "PublishResults": {
        "Type": "Pass",
        "End": true
    }
  }
}
